# Testing Quick Reference

Quick reference for running tests and generating coverage reports.

## Run All Tests with Coverage Report

```bash
# Using the generator script (Recommended)
python generate_test_coverage_summary.py

# Using make
make test-cov-report

# Using convenience scripts
.\run_tests_with_coverage.bat          # Windows
./run_tests_with_coverage.sh           # Unix/Linux/macOS
```

**Output:** Creates `TEST_COVERAGE_SUMMARY.md`, `htmlcov/`, and `coverage.json`

## Run Tests Only (No Report Generation)

```bash
# Basic test run
pytest tests/ -v

# With coverage display in terminal
pytest tests/ -v --cov=neural --cov-report=term

# With HTML coverage report
pytest tests/ -v --cov=neural --cov-report=html

# Using make
make test           # Basic tests
make test-cov       # Tests with coverage
```

## Common Test Scenarios

### Run Specific Test File
```bash
pytest tests/parser/test_parser.py -v
```

### Run Specific Test Function
```bash
pytest tests/parser/test_parser.py::test_parse_simple_model -v
```

### Run Tests by Marker
```bash
pytest tests/ -v -m unit                    # Only unit tests
pytest tests/ -v -m "not slow"              # Exclude slow tests
pytest tests/ -v -m "not requires_torch"    # Exclude PyTorch tests
```

### Run Only Failed Tests
```bash
pytest tests/ -v --lf                       # Last failed
pytest tests/ -v --ff                       # Failed first, then others
```

### Stop on First Failure
```bash
pytest tests/ -v -x
```

### Show Local Variables on Failure
```bash
pytest tests/ -v --showlocals
```

### Run with Detailed Output
```bash
pytest tests/ -vv --tb=long
```

## Coverage Analysis

### View HTML Coverage Report
```bash
# Windows
start htmlcov/index.html

# macOS
open htmlcov/index.html

# Linux
xdg-open htmlcov/index.html
```

### View Coverage Summary
```bash
# Read the generated markdown
cat TEST_COVERAGE_SUMMARY.md

# Or view in terminal during test run
pytest tests/ -v --cov=neural --cov-report=term
```

### Check Coverage for Specific Module
```bash
pytest tests/parser/ -v --cov=neural.parser --cov-report=term
```

## Available Test Markers

- `slow` - Tests that take >1 second
- `integration` - Integration tests
- `unit` - Unit tests
- `requires_gpu` - Requires GPU
- `requires_torch` - Requires PyTorch
- `requires_tensorflow` - Requires TensorFlow
- `requires_onnx` - Requires ONNX

## Quick Setup

### First Time Setup
```bash
# Activate virtual environment
.\.venv\Scripts\Activate              # Windows
source .venv/bin/activate             # Unix/Linux/macOS

# Install dev dependencies
pip install -r requirements-dev.txt

# Or install everything
pip install -e ".[full]"
```

### Before Committing
```bash
# Run tests
pytest tests/ -v

# Run linter
ruff check .

# Format code
ruff check --fix .

# Type check
mypy neural/ --ignore-missing-imports
```

## Troubleshooting

### Import Errors
```bash
# Install in development mode
pip install -e .

# Or with all dependencies
pip install -e ".[full]"
```

### Missing pytest-cov
```bash
pip install pytest-cov
```

### Tests Not Found
```bash
# Ensure you're in repo root
cd /path/to/neural-dsl

# Check test discovery
pytest --collect-only
```

## Files Generated by Coverage

- `TEST_COVERAGE_SUMMARY.md` - Executive summary (tracked in git if desired)
- `htmlcov/` - HTML coverage report (ignored by git)
- `coverage.json` - JSON coverage data (ignored by git)
- `.coverage` - Coverage database (ignored by git)

## Documentation

- Full documentation: `TEST_COVERAGE_README.md`
- Test analysis: `TEST_ANALYSIS_SUMMARY.md`
- Test suite docs: `TEST_SUITE_DOCUMENTATION_README.md`
- Agent guide: `AGENTS.md`

## Makefile Targets

```bash
make help              # Show all available commands
make test              # Run tests
make test-cov          # Run tests with coverage
make test-cov-report   # Generate full coverage report
make lint              # Run linters
make format            # Format code
```

---

**Need help?** See `TEST_COVERAGE_README.md` for detailed documentation.
